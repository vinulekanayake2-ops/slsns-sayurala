{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dulithaw/Downloads/Quiz/slns-sayurala/app/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { prisma } from \"@/lib/db\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nexport async function loginUser(officialId: string, name: string) {\r\n    try {\r\n        // Upsert user (create if not exists)\r\n        const user = await prisma.user.upsert({\r\n            where: { officialId },\r\n            update: { name }, // Update name if it changed\r\n            create: {\r\n                officialId,\r\n                name,\r\n            },\r\n        });\r\n\r\n        // Create active session\r\n        await prisma.activeSession.upsert({\r\n            where: { userId: user.id },\r\n            update: { lastActive: new Date() },\r\n            create: { userId: user.id },\r\n        });\r\n\r\n        // Set cookie for simple auth\r\n        const cookieStore = await cookies();\r\n        cookieStore.set('userId', user.id, { secure: true, httpOnly: true, path: '/' });\r\n\r\n        return { success: true, userId: user.id };\r\n    } catch (error) {\r\n        console.error(\"Login Error:\", error);\r\n        return { success: false, error: \"Failed to login\" };\r\n    }\r\n}\r\n\r\nexport async function submitQuizResult(\r\n    userId: string,\r\n    moduleId: string,\r\n    score: number,\r\n    totalQuestions: number,\r\n    answers: Record<string, number>\r\n) {\r\n    try {\r\n        const attempt = await prisma.quizAttempt.create({\r\n            data: {\r\n                userId,\r\n                moduleId,\r\n                score,\r\n                answers,\r\n                isCompleted: true,\r\n                completedAt: new Date(),\r\n            }\r\n        });\r\n\r\n        // Update session\r\n        await prisma.activeSession.update({\r\n            where: { userId },\r\n            data: {\r\n                lastActive: new Date(),\r\n                currentModuleId: null // Clear current activity\r\n            }\r\n        });\r\n\r\n        return { success: true, attemptId: attempt.id };\r\n    } catch (error) {\r\n        console.error(\"Submit Error:\", error);\r\n        return { success: false, error: \"Failed to save result\" };\r\n    }\r\n}\r\n\r\nexport async function updateSessionActivity(userId: string, moduleId: string) {\r\n    try {\r\n        await prisma.activeSession.update({\r\n            where: { userId },\r\n            data: {\r\n                lastActive: new Date(),\r\n                currentModuleId: moduleId\r\n            }\r\n        });\r\n    } catch (e) {\r\n        // Ignore session update errors (non-critical)\r\n        console.warn(\"Session update failed\", e);\r\n    }\r\n}\r\n\r\nexport async function getAdminDashboardData() {\r\n    try {\r\n        const users = await prisma.user.findMany({\r\n            include: { activeSession: true, attempts: true },\r\n            orderBy: { createdAt: 'desc' }\r\n        });\r\n\r\n        const attempts = await prisma.quizAttempt.findMany({\r\n            include: { user: true },\r\n            orderBy: { completedAt: 'desc' },\r\n            take: 50 // Latest 50\r\n        });\r\n\r\n        // Transform for UI\r\n        const formattedUsers = users.map(u => {\r\n            let status = \"Idle\";\r\n            if (u.activeSession) {\r\n                const timeDiff = new Date().getTime() - new Date(u.activeSession.lastActive).getTime();\r\n                if (timeDiff < 5 * 60 * 1000) { // Active in last 5 mins\r\n                    status = \"Active\";\r\n                    if (u.activeSession.currentModuleId) {\r\n                        status = `In Quiz (${u.activeSession.currentModuleId})`;\r\n                    }\r\n                }\r\n            }\r\n            return {\r\n                id: u.id,\r\n                officialId: u.officialId,\r\n                name: u.name,\r\n                status\r\n            };\r\n        });\r\n\r\n        const formattedAttempts = attempts.map(a => ({\r\n            id: a.id,\r\n            user: a.user.officialId,\r\n            module: a.moduleId,\r\n            score: a.score,\r\n            total: 50, // Assuming 50 for now or fetch from question count\r\n            date: a.completedAt ? new Date(a.completedAt).toISOString().split('T')[0] : 'N/A'\r\n        }));\r\n\r\n        return { success: true, users: formattedUsers, attempts: formattedAttempts };\r\n    } catch (error) {\r\n        console.error(\"Admin Data Error:\", error);\r\n        return { success: false, users: [], attempts: [] };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAKsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,6CAAA"}},
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dulithaw/Downloads/Quiz/slns-sayurala/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { motion } from \"framer-motion\";\nimport { ShieldCheck, Anchor } from \"lucide-react\";\nimport { loginUser } from \"./actions\";\nimport Image from \"next/image\";\n\nexport default function Home() {\n  const [officialId, setOfficialId] = useState(\"\");\n  const [name, setName] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const router = useRouter();\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const result = await loginUser(officialId, name);\n      if (result.success) {\n        // Backup in localStorage for client-side easy access\n        localStorage.setItem(\"user\", JSON.stringify({ officialId, name, id: result.userId }));\n        router.push(\"/modules\");\n      } else {\n        console.error(result.error);\n        setLoading(false);\n      }\n    } catch (err) {\n      console.error(\"Login failed\", err);\n      setLoading(false);\n    }\n  };\n\n  return (\n    <main className=\"flex min-h-screen flex-col items-center justify-center p-6 bg-navy-900 relative\">\n\n      {/* Subtle Grid Background */}\n      <div className=\"absolute inset-0 bg-[linear-gradient(to_right,#112240_1px,transparent_1px),linear-gradient(to_bottom,#112240_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)] opacity-20 pointer-events-none\" />\n\n      <motion.div\n        className=\"z-10 w-full max-w-[400px] bg-navy-800 border border-navy-600 shadow-2xl rounded-sm overflow-hidden\"\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.6, delay: 2.5 }}\n      >\n        {/* Header Section */}\n        <div className=\"bg-navy-950 p-8 pb-6 text-center border-b border-navy-700 relative\">\n          <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-navy-900 via-gold-600 to-navy-900\" />\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"relative w-20 h-20\">\n              <Image\n                src=\"/logo.png\"\n                alt=\"SLNS Sayurala Logo\"\n                fill\n                className=\"object-contain drop-shadow-md\"\n                priority\n              />\n            </div>\n          </div>\n          <h1 className=\"text-2xl font-bold text-white font-heading tracking-widest uppercase mb-1\">\n            SLNS Sayurala\n          </h1>\n          <p className=\"text-gold-500/80 text-xs tracking-[0.2em] uppercase font-medium\">\n            Training Portal\n          </p>\n        </div>\n\n        {/* Form Section */}\n        <div className=\"p-8 pt-6 space-y-6\">\n          <form onSubmit={handleLogin} className=\"space-y-5\">\n            <div className=\"space-y-1.5\">\n              <label htmlFor=\"officialId\" className=\"block text-xs font-semibold text-steel-200 uppercase tracking-wider\">\n                Official ID\n              </label>\n              <div className=\"relative group\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <div className=\"w-1.5 h-1.5 rounded-full bg-gold-600/50 group-focus-within:bg-gold-500 transition-colors\" />\n                </div>\n                <input\n                  id=\"officialId\"\n                  type=\"text\"\n                  required\n                  value={officialId}\n                  onChange={(e) => setOfficialId(e.target.value)}\n                  className=\"w-full pl-8 pr-4 py-2.5 bg-navy-900 border border-navy-600 text-white placeholder-navy-500 focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-all rounded-sm font-mono text-sm\"\n                  placeholder=\"ENTER ID\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-1.5\">\n              <label htmlFor=\"name\" className=\"block text-xs font-semibold text-steel-200 uppercase tracking-wider\">\n                Name & Rank\n              </label>\n              <div className=\"relative group\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <div className=\"w-1.5 h-1.5 rounded-full bg-gold-600/50 group-focus-within:bg-gold-500 transition-colors\" />\n                </div>\n                <input\n                  id=\"name\"\n                  type=\"text\"\n                  required\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  className=\"w-full pl-8 pr-4 py-2.5 bg-navy-900 border border-navy-600 text-white placeholder-navy-500 focus:outline-none focus:border-gold-500 focus:ring-1 focus:ring-gold-500 transition-all rounded-sm font-sans text-sm\"\n                  placeholder=\"NAME\"\n                />\n              </div>\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full py-3 mt-4 bg-gold-600 hover:bg-gold-500 text-navy-950 font-bold rounded-sm shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed uppercase tracking-widest text-xs flex items-center justify-center gap-2 border border-transparent hover:border-gold-400\"\n            >\n              {loading ? \"Verifying...\" : \"Access System\"}\n              {!loading && <ShieldCheck className=\"w-4 h-4 opacity-80\" />}\n            </button>\n          </form>\n        </div>\n\n        {/* Footer */}\n        <div className=\"px-8 py-4 bg-navy-950/50 border-t border-navy-700 text-center\">\n          <p className=\"text-[10px] text-navy-500 uppercase tracking-wider font-semibold\">\n            Authorized Use Only\n          </p>\n        </div>\n      </motion.div>\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAPA;;;;;;;AASe,SAAS;;IACtB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,SAAS,IAAA,kJAAS;IAExB,MAAM,cAAc,OAAO;QACzB,EAAE,cAAc;QAChB,WAAW;QAEX,IAAI;YACF,MAAM,SAAS,MAAM,IAAA,2JAAS,EAAC,YAAY;YAC3C,IAAI,OAAO,OAAO,EAAE;gBAClB,qDAAqD;gBACrD,aAAa,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC;oBAAE;oBAAY;oBAAM,IAAI,OAAO,MAAM;gBAAC;gBAClF,OAAO,IAAI,CAAC;YACd,OAAO;gBACL,QAAQ,KAAK,CAAC,OAAO,KAAK;gBAC1B,WAAW;YACb;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,gBAAgB;YAC9B,WAAW;QACb;IACF;IAEA,qBACE,6LAAC;QAAK,WAAU;;0BAGd,6LAAC;gBAAI,WAAU;;;;;;0BAEf,6LAAC,uMAAM,CAAC,GAAG;gBACT,WAAU;gBACV,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAG;gBAC7B,SAAS;oBAAE,SAAS;oBAAG,GAAG;gBAAE;gBAC5B,YAAY;oBAAE,UAAU;oBAAK,OAAO;gBAAI;;kCAGxC,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;;;;;0CACf,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC;oCAAI,WAAU;8CACb,cAAA,6LAAC,2IAAK;wCACJ,KAAI;wCACJ,KAAI;wCACJ,IAAI;wCACJ,WAAU;wCACV,QAAQ;;;;;;;;;;;;;;;;0CAId,6LAAC;gCAAG,WAAU;0CAA4E;;;;;;0CAG1F,6LAAC;gCAAE,WAAU;0CAAkE;;;;;;;;;;;;kCAMjF,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAK,UAAU;4BAAa,WAAU;;8CACrC,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAM,SAAQ;4CAAa,WAAU;sDAAsE;;;;;;sDAG5G,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDAAI,WAAU;8DACb,cAAA,6LAAC;wDAAI,WAAU;;;;;;;;;;;8DAEjB,6LAAC;oDACC,IAAG;oDACH,MAAK;oDACL,QAAQ;oDACR,OAAO;oDACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;oDAC7C,WAAU;oDACV,aAAY;;;;;;;;;;;;;;;;;;8CAKlB,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAM,SAAQ;4CAAO,WAAU;sDAAsE;;;;;;sDAGtG,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDAAI,WAAU;8DACb,cAAA,6LAAC;wDAAI,WAAU;;;;;;;;;;;8DAEjB,6LAAC;oDACC,IAAG;oDACH,MAAK;oDACL,QAAQ;oDACR,OAAO;oDACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;oDACvC,WAAU;oDACV,aAAY;;;;;;;;;;;;;;;;;;8CAKlB,6LAAC;oCACC,MAAK;oCACL,UAAU;oCACV,WAAU;;wCAET,UAAU,iBAAiB;wCAC3B,CAAC,yBAAW,6LAAC,sOAAW;4CAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;kCAM1C,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAE,WAAU;sCAAmE;;;;;;;;;;;;;;;;;;;;;;;AAO1F;GA3HwB;;QAIP,kJAAS;;;KAJF"}}]
}
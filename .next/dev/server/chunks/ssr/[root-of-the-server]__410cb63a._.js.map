{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dulithaw/Downloads/Quiz/slns-sayurala/app/actions.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { prisma } from \"@/lib/db\";\r\nimport { cookies } from \"next/headers\";\r\n\r\nexport async function loginUser(officialId: string, name: string) {\r\n    try {\r\n        // Upsert user (create if not exists)\r\n        const user = await prisma.user.upsert({\r\n            where: { officialId },\r\n            update: { name }, // Update name if it changed\r\n            create: {\r\n                officialId,\r\n                name,\r\n            },\r\n        });\r\n\r\n        // Create active session\r\n        await prisma.activeSession.upsert({\r\n            where: { userId: user.id },\r\n            update: { lastActive: new Date() },\r\n            create: { userId: user.id },\r\n        });\r\n\r\n        // Set cookie for simple auth\r\n        const cookieStore = await cookies();\r\n        cookieStore.set('userId', user.id, { secure: false, httpOnly: true, path: '/' });\r\n\r\n        return { success: true, userId: user.id };\r\n    } catch (error) {\r\n        console.error(\"Login Error:\", error);\r\n        return { success: false, error: \"Failed to login\" };\r\n    }\r\n}\r\n\r\nexport async function submitQuizResult(\r\n    userId: string,\r\n    moduleId: string,\r\n    score: number,\r\n    totalQuestions: number,\r\n    answers: Record<string, number>\r\n) {\r\n    try {\r\n        const attempt = await prisma.quizAttempt.create({\r\n            data: {\r\n                userId,\r\n                moduleId,\r\n                score,\r\n                answers: JSON.stringify(answers),\r\n                isCompleted: true,\r\n                completedAt: new Date(),\r\n            }\r\n        });\r\n\r\n        // Update session\r\n        await prisma.activeSession.update({\r\n            where: { userId },\r\n            data: {\r\n                lastActive: new Date(),\r\n                currentModuleId: null // Clear current activity\r\n            }\r\n        });\r\n\r\n        return { success: true, attemptId: attempt.id };\r\n    } catch (error) {\r\n        console.error(\"Submit Error:\", error);\r\n        return { success: false, error: \"Failed to save result\" };\r\n    }\r\n}\r\n\r\nexport async function updateSessionActivity(userId: string, moduleId: string, currentQuestionIndex: number = 0, totalQuestions: number = 50) {\r\n    try {\r\n        console.log(\"ðŸ”„ Updating session:\", { userId, moduleId, currentQuestionIndex, totalQuestions });\r\n        await prisma.activeSession.update({\r\n            where: { userId },\r\n            data: {\r\n                lastActive: new Date(),\r\n                currentModuleId: moduleId,\r\n                currentQuestionIndex,\r\n                totalQuestions\r\n            }\r\n        });\r\n        console.log(\"âœ… Session updated successfully\");\r\n    } catch (e) {\r\n        // Ignore session update errors (non-critical)\r\n        console.error(\"âŒ Session update failed\", e);\r\n    }\r\n}\r\n\r\nexport async function getAdminDashboardData() {\r\n    try {\r\n        const users = await prisma.user.findMany({\r\n            where: {\r\n                officialId: {\r\n                    not: 'ADMIN'\r\n                }\r\n            },\r\n            include: { activeSession: true, attempts: true },\r\n            orderBy: { createdAt: 'desc' }\r\n        });\r\n\r\n        const attempts = await prisma.quizAttempt.findMany({\r\n            include: { user: true },\r\n            orderBy: { completedAt: 'desc' },\r\n            take: 50 // Latest 50\r\n        });\r\n\r\n        // Transform for UI\r\n        const formattedUsers = users.map((u: any) => {\r\n            let status = \"Idle\";\r\n            let liveProgress = null;\r\n\r\n            if (u.activeSession) {\r\n                const timeDiff = new Date().getTime() - new Date(u.activeSession.lastActive).getTime();\r\n                if (timeDiff < 5 * 60 * 1000) { // Active in last 5 mins\r\n                    status = \"Active\";\r\n                    if (u.activeSession.currentModuleId) {\r\n                        status = \"In Quiz\";\r\n                        liveProgress = {\r\n                            module: u.activeSession.currentModuleId,\r\n                            current: u.activeSession.currentQuestionIndex || 0,\r\n                            total: u.activeSession.totalQuestions || 50,\r\n                            percentage: Math.round(((u.activeSession.currentQuestionIndex || 0) / (u.activeSession.totalQuestions || 50)) * 100)\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n            return {\r\n                id: u.id,\r\n                officialId: u.officialId,\r\n                name: u.name,\r\n                status,\r\n                liveProgress,\r\n                history: u.attempts.map((a: any) => {\r\n                    const diff = a.completedAt ? new Date(a.completedAt).getTime() - new Date(a.startedAt).getTime() : 0;\r\n                    const durationMinutes = Math.floor(diff / 60000);\r\n                    const durationSeconds = Math.floor((diff % 60000) / 1000);\r\n\r\n                    return {\r\n                        id: a.id,\r\n                        module: a.moduleId,\r\n                        score: a.score || 0,\r\n                        total: 50,\r\n                        startedAt: new Date(a.startedAt).toLocaleString(),\r\n                        completedAt: a.completedAt ? new Date(a.completedAt).toLocaleString() : \"In Progress\",\r\n                        duration: a.completedAt ? `${durationMinutes}m ${durationSeconds}s` : \"N/A\"\r\n                    };\r\n                })\r\n            };\r\n        });\r\n\r\n        const formattedAttempts = attempts.map((a: any) => ({\r\n            id: a.id,\r\n            user: a.user.officialId,\r\n            module: a.moduleId,\r\n            score: a.score || 0,\r\n            total: 50, // Assuming 50 for now or fetch from question count\r\n            date: a.completedAt ? new Date(a.completedAt).toISOString().split('T')[0] : 'N/A'\r\n        }));\r\n\r\n        return { success: true, users: formattedUsers, attempts: formattedAttempts };\r\n    } catch (error) {\r\n        console.error(\"Admin Data Error:\", error);\r\n        return { success: false, users: [], attempts: [] };\r\n    }\r\n}\r\n\r\nexport async function logoutUser() {\r\n    const cookieStore = await cookies();\r\n    cookieStore.delete('userId');\r\n    return { success: true };\r\n}\r\n\r\nexport async function loginAdmin() {\r\n    const cookieStore = await cookies();\r\n    // Non-secure for local IP access\r\n    cookieStore.set('userId', 'ADMIN-SESSION-TOKEN', { secure: false, httpOnly: true, path: '/' });\r\n    return { success: true };\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAuKsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,8CAAA"}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dulithaw/Downloads/Quiz/slns-sayurala/components/ModuleCard.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { motion } from \"framer-motion\";\r\nimport { LucideIcon } from \"lucide-react\";\r\n\r\ninterface ModuleCardProps {\r\n    id: string;\r\n    name: string;\r\n    icon: LucideIcon;\r\n    onClick: () => void;\r\n    index: number;\r\n}\r\n\r\nexport default function ModuleCard({ id, name, icon: Icon, onClick, index }: ModuleCardProps) {\r\n    return (\r\n        <motion.div\r\n            layout\r\n            initial={{ opacity: 0, y: 30 }}\r\n            animate={{ opacity: 1, y: 0 }}\r\n            transition={{ delay: index * 0.1, duration: 0.5, type: \"spring\" }}\r\n            whileHover={{\r\n                scale: 1.02,\r\n                y: -2,\r\n            }}\r\n            whileTap={{ scale: 0.98 }}\r\n            onClick={onClick}\r\n            className=\"group relative flex flex-col items-center justify-center p-6 h-48 bg-navy-800 border border-navy-600 hover:border-gold-500 rounded-sm cursor-pointer overflow-hidden transition-all duration-300 shadow-md hover:shadow-lg\"\r\n        >\r\n            {/* Background Effect */}\r\n            <div className=\"absolute inset-0 bg-gradient-to-br from-navy-800 to-navy-900 opacity-100\" />\r\n\r\n            {/* Hover Highlight (Subtle) */}\r\n            <div className=\"absolute inset-0 bg-gold-600/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\r\n\r\n            <motion.div\r\n                className=\"z-10 p-4 mb-3 rounded-sm bg-navy-900 border border-navy-700 group-hover:border-gold-500/50 transition-all duration-300\"\r\n            >\r\n                <Icon className=\"w-8 h-8 text-steel-200 group-hover:text-gold-500 transition-colors\" />\r\n            </motion.div>\r\n\r\n            <h3 className=\"z-10 text-center text-sm font-bold text-steel-100 group-hover:text-white tracking-widest font-heading uppercase\">\r\n                {name}\r\n            </h3>\r\n\r\n            <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-transparent group-hover:bg-gold-500 transition-colors duration-300\" />\r\n        </motion.div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAae,SAAS,WAAW,EAAE,EAAE,EAAE,IAAI,EAAE,MAAM,IAAI,EAAE,OAAO,EAAE,KAAK,EAAmB;IACxF,qBACI,8OAAC,oMAAM,CAAC,GAAG;QACP,MAAM;QACN,SAAS;YAAE,SAAS;YAAG,GAAG;QAAG;QAC7B,SAAS;YAAE,SAAS;YAAG,GAAG;QAAE;QAC5B,YAAY;YAAE,OAAO,QAAQ;YAAK,UAAU;YAAK,MAAM;QAAS;QAChE,YAAY;YACR,OAAO;YACP,GAAG,CAAC;QACR;QACA,UAAU;YAAE,OAAO;QAAK;QACxB,SAAS;QACT,WAAU;;0BAGV,8OAAC;gBAAI,WAAU;;;;;;0BAGf,8OAAC;gBAAI,WAAU;;;;;;0BAEf,8OAAC,oMAAM,CAAC,GAAG;gBACP,WAAU;0BAEV,cAAA,8OAAC;oBAAK,WAAU;;;;;;;;;;;0BAGpB,8OAAC;gBAAG,WAAU;0BACT;;;;;;0BAGL,8OAAC;gBAAI,WAAU;;;;;;;;;;;;AAG3B"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dulithaw/Downloads/Quiz/slns-sayurala/app/modules/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { logoutUser } from \"@/app/actions\";\r\nimport {\r\n    Compass, Wrench, Zap, Anchor, Radio, Crosshair,\r\n    Package, Users, ShieldAlert, Ship, LogOut\r\n} from \"lucide-react\";\r\nimport ModuleCard from \"@/components/ModuleCard\";\r\nimport { motion } from \"framer-motion\";\r\n\r\nconst MODULES = [\r\n    { id: \"navigation\", name: \"Navigation\", icon: Compass },\r\n    { id: \"marine-engineering\", name: \"Marine Engineering\", icon: Wrench },\r\n    { id: \"electrical-engineering\", name: \"Electrical Engineering\", icon: Zap },\r\n    { id: \"seamanship\", name: \"Seamanship\", icon: Anchor },\r\n    { id: \"communication\", name: \"Communication\", icon: Radio },\r\n    { id: \"gunnery\", name: \"Gunnery\", icon: Crosshair },\r\n    { id: \"logistics\", name: \"Logistics\", icon: Package },\r\n    { id: \"divisional-duties\", name: \"Divisional Duties\", icon: Users },\r\n    { id: \"nbcd\", name: \"NBCD\", icon: ShieldAlert }, // NBCD = Nuclear Biological Chemical Defence\r\n    { id: \"myship\", name: \"Myship\", icon: Ship },\r\n];\r\n\r\nexport default function ModulesPage() {\r\n    const router = useRouter();\r\n\r\n    const handleModuleSelect = (moduleId: string) => {\r\n        // Navigate to quiz start page or direct to quiz\r\n        router.push(`/quiz/${moduleId}`);\r\n    };\r\n\r\n    const handleLogout = async () => {\r\n        localStorage.removeItem(\"user\");\r\n        await logoutUser();\r\n        router.push(\"/\");\r\n    };\r\n\r\n    return (\r\n        <main className=\"min-h-screen p-8 bg-navy-900 text-steel-100 relative overflow-x-hidden\">\r\n            {/* Background elements */}\r\n            <div className=\"fixed inset-0 z-0 pointer-events-none\">\r\n                <div className=\"absolute top-0 right-0 w-[500px] h-[500px] bg-navy-800/30 rounded-full blur-[100px]\" />\r\n                <div className=\"absolute bottom-0 left-0 w-[500px] h-[500px] bg-blue-900/10 rounded-full blur-[100px]\" />\r\n            </div>\r\n\r\n            <div className=\"relative z-10 max-w-7xl mx-auto space-y-10\">\r\n                <header className=\"flex flex-col items-center justify-center space-y-3 py-10 relative\">\r\n                    <button\r\n                        onClick={handleLogout}\r\n                        className=\"absolute top-0 right-0 flex items-center gap-2 px-4 py-2 text-red-400 hover:text-red-300 hover:bg-red-400/10 rounded-full transition-all text-sm font-bold uppercase tracking-wider\"\r\n                    >\r\n                        <LogOut className=\"w-4 h-4\" />\r\n                        Logout\r\n                    </button>\r\n                    <motion.h1\r\n                        initial={{ opacity: 0, y: -20 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        transition={{ duration: 0.8 }}\r\n                        className=\"text-4xl md:text-5xl font-bold text-gold-500 font-heading tracking-widest text-center\"\r\n                    >\r\n                        SLNS SAYURALA\r\n                    </motion.h1>\r\n                    <motion.p\r\n                        initial={{ opacity: 0 }}\r\n                        animate={{ opacity: 1 }}\r\n                        transition={{ delay: 0.3 }}\r\n                        className=\"text-steel-200 uppercase tracking-widest text-sm\"\r\n                    >\r\n                        Select a training module to begin\r\n                    </motion.p>\r\n                </header>\r\n\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 pb-20\">\r\n                    {MODULES.map((module, index) => (\r\n                        <ModuleCard\r\n                            key={module.id}\r\n                            id={module.id}\r\n                            name={module.name}\r\n                            icon={module.icon}\r\n                            index={index}\r\n                            onClick={() => handleModuleSelect(module.id)}\r\n                        />\r\n                    ))}\r\n                </div>\r\n            </div>\r\n        </main>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AAVA;;;;;;;AAYA,MAAM,UAAU;IACZ;QAAE,IAAI;QAAc,MAAM;QAAc,MAAM,mNAAO;IAAC;IACtD;QAAE,IAAI;QAAsB,MAAM;QAAsB,MAAM,gNAAM;IAAC;IACrE;QAAE,IAAI;QAA0B,MAAM;QAA0B,MAAM,uMAAG;IAAC;IAC1E;QAAE,IAAI;QAAc,MAAM;QAAc,MAAM,gNAAM;IAAC;IACrD;QAAE,IAAI;QAAiB,MAAM;QAAiB,MAAM,6MAAK;IAAC;IAC1D;QAAE,IAAI;QAAW,MAAM;QAAW,MAAM,yNAAS;IAAC;IAClD;QAAE,IAAI;QAAa,MAAM;QAAa,MAAM,mNAAO;IAAC;IACpD;QAAE,IAAI;QAAqB,MAAM;QAAqB,MAAM,6MAAK;IAAC;IAClE;QAAE,IAAI;QAAQ,MAAM;QAAQ,MAAM,mOAAW;IAAC;IAC9C;QAAE,IAAI;QAAU,MAAM;QAAU,MAAM,0MAAI;IAAC;CAC9C;AAEc,SAAS;IACpB,MAAM,SAAS,IAAA,+IAAS;IAExB,MAAM,qBAAqB,CAAC;QACxB,gDAAgD;QAChD,OAAO,IAAI,CAAC,CAAC,MAAM,EAAE,UAAU;IACnC;IAEA,MAAM,eAAe;QACjB,aAAa,UAAU,CAAC;QACxB,MAAM,IAAA,yJAAU;QAChB,OAAO,IAAI,CAAC;IAChB;IAEA,qBACI,8OAAC;QAAK,WAAU;;0BAEZ,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;wBAAI,WAAU;;;;;;;;;;;;0BAGnB,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAO,WAAU;;0CACd,8OAAC;gCACG,SAAS;gCACT,WAAU;;kDAEV,8OAAC,oNAAM;wCAAC,WAAU;;;;;;oCAAY;;;;;;;0CAGlC,8OAAC,oMAAM,CAAC,EAAE;gCACN,SAAS;oCAAE,SAAS;oCAAG,GAAG,CAAC;gCAAG;gCAC9B,SAAS;oCAAE,SAAS;oCAAG,GAAG;gCAAE;gCAC5B,YAAY;oCAAE,UAAU;gCAAI;gCAC5B,WAAU;0CACb;;;;;;0CAGD,8OAAC,oMAAM,CAAC,CAAC;gCACL,SAAS;oCAAE,SAAS;gCAAE;gCACtB,SAAS;oCAAE,SAAS;gCAAE;gCACtB,YAAY;oCAAE,OAAO;gCAAI;gCACzB,WAAU;0CACb;;;;;;;;;;;;kCAKL,8OAAC;wBAAI,WAAU;kCACV,QAAQ,GAAG,CAAC,CAAC,QAAQ,sBAClB,8OAAC,oIAAU;gCAEP,IAAI,OAAO,EAAE;gCACb,MAAM,OAAO,IAAI;gCACjB,MAAM,OAAO,IAAI;gCACjB,OAAO;gCACP,SAAS,IAAM,mBAAmB,OAAO,EAAE;+BALtC,OAAO,EAAE;;;;;;;;;;;;;;;;;;;;;;AAY1C"}}]
}